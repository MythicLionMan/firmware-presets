#$ TITLE: Standard Configuration
#$ FIRMWARE_VERSION: 4.3
#$ CATEGORY: OTHER
#$ STATUS: COMMUNITY
#$ KEYWORDS: personal, GPS
#$ AUTHOR: MythicLionMan
#$ DESCRIPTION: This is my 'standard' quad setup that I have on pretty much all of my rigs. All changes are optional, if nothing is selected nothing will happen.
#$ DESCRIPTION: Failsafe - Stage 2 failsafe is set to Drop. GPS rescue must be enabled via OSD.
#$ DESCRIPTION: Radio Setup - Sets the min_check, max_check and min_throttle values to match the gimbals of my radio.
#$ DESCRIPTION: Radio Protocol - Configures the radio protocol, and optionally LQ emulation for CrSf.
#$ DESCRIPTION: Blackbox Tuning - Increases blackbox_p_ratio for improved resolution tuning when using PIDToolbox
#$ DESCRIPTION: Motor Protocol - Turns on DSHOT600 and sets the motor pwm rate.
#$ DESCRIPTION: GPS - Configures the GPS. RTH distance is set to 50m (the minimum) and sanity checks are disabled when possible. Arming without a fix is set to true.
#$ WARNING: DSHOT with the ESCs that don't support DSHOT is dangerous and can spin up the motors right away without arming.

# I grabbed this setup from my CLI dumps of the backups of Inky, Blinky and Clyde. I've tried to standardize to just the stuff I custom configure on all builds.

#$ OPTION BEGIN (CHECKED): Failsafe
# Hold the throttle in stage 1 failsafe
rxfail 3 h
#$ OPTION END


#$ OPTION BEGIN (CHECKED): Standard Features
# I have airmode on a switch, so I want it disabled by default
feature -AIRMODE
feature TELEMETRY
beeper -ON_USB
set small_angle = 180
#$ OPTION END

# Options specific to my radio
#$ OPTION BEGIN (CHECKED): Radio Setup
# Setting min_check to 1005 since my radio can handle a lower threshold
set min_check = 1005
set max_check = 1995
# Clyde was 1070, Blinky was 1023, Inky was 1070
set min_throttle = 1070
#$ OPTION END

#$ OPTION_GROUP BEGIN: Radio Protocol
#$ OPTION BEGIN (UNCHECKED): None
#$ OPTION END
#$ OPTION BEGIN (UNCHECKED): FrSky SBUS
    set serialrx_provider = SBUS
#$ OPTION END
#$ OPTION BEGIN (UNCHECKED): Crossfire
    set serialrx_provider = CRSF
    
    # Crossfire doesn't have a 'cell voltage' option. Since I always monitor per cell
    # change the total voltage to cell voltage. If crossfire ever updates their
    # telemetry, I can remove this and update my OpenTX setup to report the correct
    # values.
    set report_cell_voltage = ON
#$ OPTION END
#$ OPTION BEGIN (CHECKED): Crossfire + DJI LQ
    set serialrx_provider = CRSF

    # Sets up CrSf RSSI for DJI Goggles by reading RSSI from a channel. This requires
    # setup on the crossfire receiver on the radio as well. Once I can properly report
    # LQ on the DJI OSD I can disable this hack.
    set rssi_channel = 12

    # Set the RSSI channel to 1000 on a failsafe. Ideally this should only be done when
    # failsafe is also being configured, but there's no easy way to do an 'and' clause
    # with this setup.
    rxfail 11 s 1000

    # Crossfire doesn't have a 'cell voltage' option. Since I always monitor per cell
    # change the total voltage to cell voltage. If crossfire ever updates their
    # telemetry, I can remove this and update my OpenTX setup to report the correct
    # values.
    set report_cell_voltage = ON
#$ OPTION END
#$ OPTION_GROUP END

# Sets up blackbox for tuning
#$ OPTION BEGIN (UNCHECKED): Blackbox Tuning
set blackbox_p_ratio = 64
#$ OPTION END

#$ OPTION BEGIN (CHECKED): Motor Protocol
# On all
set dshot_bidir = ON
set use_unsynced_pwm = OFF
# Clyde DSHOT600, Blinky DSHOT300, Inky -
set motor_pwm_protocol = DSHOT600
# Clyde, Blinky = 480, Inky = -
# I have no idea why this is set to this value :-(
set motor_pwm_rate = 480
#$ OPTION END

#$ OPTION BEGIN (CHECKED): GPS
# Reset the GPS parameters to the defaults
#$ INCLUDE: presets/4.3/other/reset_gps.txt
feature GPS
set gps_provider = UBLOX
set gps_auto_baud = ON
# These are failsafe settings, so ideally they should only be set if
# failsafe is being configured as well as GPS.
set gps_rescue_min_dth = 50
set gps_rescue_allow_arming_without_fix = ON
# Disable the sanity checks when GPS is activated by a switch, since
# presumably the pilot knows what they want
set gps_rescue_sanity_checks = RESCUE_SANITY_FS_ONLY
#$ OPTION END

# Only on blinky. I'm pretty sure that this is obsolete
#set pid_process_denom = 2
#set tlm_halfduplex = OFF

#$ OPTION BEGIN (UNCHECKED): Setup OSD
#$ INCLUDE: presets/4.3/osd/MythicLionMan.txt
#$ OPTION END

#$ OPTION BEGIN (UNCHECKED): Setup Rates
#$ INCLUDE: presets/4.3/rates/MythicLionMan.txt
#$ OPTION END

#$ OPTION BEGIN (UNCHECKED): Setup Modes
#$ INCLUDE: presets/4.3/modes/MythicLionMan.txt
#$ OPTION END

# NOTE This section is disabled because I'm not sure how to pass options to the tune includes.
#      To enable add the '$' back to the beginning of each line after the '#'.

# NOTE Make sure to turn off the ADC filter on the radio!

# OPTION_GROUP BEGIN: Link
# OPTION BEGIN (UNCHECKED): None
# OPTION END
# OPTION BEGIN (UNCHECKED): Crossfire 50Hz
# INCLUDE: presets/4.3/rc_link/tbs/crossfire_150hz.txt
# OPTION END
# OPTION BEGIN (UNCHECKED): FrSky SBUS
# INCLUDE: presets/4.3/rc_link/frsky_sbus.txt
# OPTION END
# OPTION_GROUP END

# NOTE I can't find the rc_smoothing options. I think it's been absorbed into something else

# OPTION_GROUP BEGIN: Filters
# OPTION BEGIN (UNCHECKED): None
# OPTION END
# OPTION BEGIN (UNCHECKED): Noisy Build
# INCLUDE: presets/4.3/filters/default_rpm_noisy.txt
# OPTION END
# OPTION_GROUP END



# OPTION_GROUP BEGIN: Tune
# OPTION BEGIN (UNCHECKED): None
# OPTION END
# OPTION BEGIN (UNCHECKED): Supafly
# OPTION BEGIN (CHECKED): RPM filtering
# OPTION BEGIN (UNCHECKED): 4s Lipo with No HD Cam (2400-2700kv motors)
# INCLUDE: presets/4.3/tune/SupaflyFPV_Freestyle_5_Inch_EasyTune.txt
# OPTION END
# OPTION_GROUP END
